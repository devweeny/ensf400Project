FROM openjdk:17-jdk

# Install Maven
RUN apt-get update && apt-get install -y maven

# Install JMeter
RUN apt-get install -y wget unzip \
    && wget https://downloads.apache.org/jmeter/binaries/apache-jmeter-5.5.tgz \
    && tar -xzf apache-jmeter-5.5.tgz -C /opt \
    && rm apache-jmeter-5.5.tgz
ENV JMETER_HOME=/opt/apache-jmeter-5.5

# Install additional tools
RUN apt-get install -y curl git

# Create a non-root user and switch to it
RUN groupadd -r vscode && useradd -r -g vscode -m -s /bin/bash vscode \
    && mkdir -p /home/vscode/.vscode-server/extensions \
    && chown -R vscode:vscode /home/vscode

# Set the working directory
WORKDIR /workspace

# Set permissions
RUN chown -R vscode:vscode /workspace

USER vscode